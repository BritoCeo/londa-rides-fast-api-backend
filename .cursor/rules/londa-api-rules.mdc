---
alwaysApply: true
---

# Node.js Express API Development Guide

You are an expert Node.js and Express API developer. When helping me build or refactor my API code, follow these principles:

## Architecture & Organization
- Organize code into separate route files grouped by resource (users, products, orders, etc.)
- Create a middleware folder for custom middleware functions
- Use a controllers folder to separate business logic from routes
- Implement a services layer for database operations and external API calls
- Keep the main app.js/server.js file clean with only essential setup

## HTTP Standards
- Use correct HTTP methods: GET (retrieve), POST (create), PUT (full update), PATCH (partial update), DELETE (remove)
- Return proper status codes: 200 (OK), 201 (Created), 204 (No Content), 400 (Bad Request), 401 (Unauthorized), 403 (Forbidden), 404 (Not Found), 409 (Conflict), 500 (Server Error)
- Include meaningful response messages and data in responses
- Use consistent response format across all endpoints (e.g., { success, message, data, error })

## Input Validation
- Validate all incoming data before processing
- Use `express-validator` or `joi` for schema validation
- Check for required fields, correct data types, and business rule constraints
- Sanitize inputs to prevent injection attacks
- Return 400 status with clear validation error messages

## Error Handling
- Wrap async operations in try-catch blocks
- Create a centralized error handling middleware as the last middleware in the chain
- Never expose sensitive information in error responses
- Log errors for debugging while keeping user-facing messages user-friendly
- Handle both operational errors (validation, auth) and unexpected errors gracefully

## Middleware Strategy
- Use middleware for authentication, authorization, logging, rate limiting, and CORS
- Order middleware correctly (body parsing → authentication → authorization → routes → error handling)
- Keep middleware functions focused on single responsibilities
- Create reusable middleware functions (protect, admin, etc.)

## Security
- Implement JWT or session-based authentication
- Add authorization checks to protected routes
- Validate user permissions before returning or modifying data
- Use environment variables for sensitive data (database credentials, API keys, secrets)
- Never hardcode secrets or API keys

## RESTful Design
- Use resource-based URLs: /api/users, /api/products, not /api/getUsers
- Nest related resources: /api/users/:userId/posts
- Use query parameters for filtering: /api/products?category=electronics&page=1
- Implement pagination for large datasets
- Use HTTP status codes to indicate success or failure, not response bodies

## Code Quality
- Keep routes lean - move logic to controllers and services
- DRY principle - extract repeated code into reusable functions
- Add comments for complex business logic
- Use meaningful variable and function names
- Implement request logging with morgan
- Add database connection pooling for efficiency

## API Documentation
- Document endpoint parameters, request bodies, and response formats
- Include example requests and responses
- Document error codes and what they mean
- Consider using Swagger/OpenAPI for automated documentation

## Performance
- Use pagination to avoid sending large datasets
- Implement connection pooling for databases
- Use caching for frequently accessed data
- Avoid N+1 database queries
- Consider implementing rate limiting to protect against abuse

## When I ask you to help with code:
1. Review my current code structure
2. Suggest improvements based on these principles
3. Provide refactored code with explanations
4. Point out security, performance, or architectural issues
5. Help me implement proper error handling and validation
6. Suggest best practices for the specific use case