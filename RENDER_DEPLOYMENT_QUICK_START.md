# Render Deployment Quick Start Guide

This guide will help you deploy your FastAPI application to Render using the `render.yaml` file.

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **GitHub Repository**: Your code should be in a GitHub repository
3. **Firebase Service Account Key**: JSON file for Firestore access

## Deployment Steps

### Option 1: Using Blueprint (Recommended)

1. **Connect Repository to Render**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" → "Blueprint"
   - Select "Public Git Repository" tab
   - Enter your repository URL
   - Click "Connect"
   - Render will automatically detect `render.yaml` and show your service

2. **Configure Environment Variables** (Before deploying):
   - Click on the service to expand it
   - Go to the "Environment" section
   - Add the following **REQUIRED** environment variables:

#### Required Environment Variables

| Variable | Description | How to Set |
|----------|-------------|------------|
| `FIREBASE_CREDENTIALS_JSON` | **REQUIRED** - Full JSON content of your Firebase service account key | Copy entire content from `londa-cd054-firebase-adminsdk-fbsvc-d4c5117970.json` |
| `FIREBASE_PROJECT_ID` | Already set in render.yaml | `londa-cd054` (default) |
| `GOOGLE_MAPS_API_KEY` | **REQUIRED** - Your Google Maps API key | Set your API key |
| `SMTP_USER` | **REQUIRED** - SMTP email username | Your email address |
| `SMTP_PASS` | **REQUIRED** - SMTP email password | Your email app password |
| `SECRET_KEY` | **REQUIRED** - Secret key for JWT (auto-generated by Render) | Render will generate this automatically |

#### Optional Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `SMTP_FROM` | From email address | `noreply@londarides.com` |
| `EMAIL_ACTIVATION_SECRET` | Secret for email verification | Set if needed |
| `NYLAS_API_KEY` | Nylas API key | Optional |
| `BACKEND_CORS_ORIGINS` | CORS allowed origins (comma-separated) | Update with your frontend URLs |

3. **Deploy**:
   - Review all settings
   - Click "Apply" at the bottom
   - Render will build and deploy your service
   - Monitor the build logs

### Option 2: Manual Web Service Creation

1. **Create Web Service**:
   - Go to [Render Dashboard](https://dashboard.render.com)
   - Click "New +" → "Web Service"
   - Select "Public Git Repository" tab
   - Enter your repository URL
   - Click "Connect"

2. **Configure Service**:
   - **Name**: `londa-apis` (or your preferred name)
   - **Region**: `Oregon` (or your preferred region)
   - **Branch**: `main` (or your default branch)
   - **Root Directory**: (leave empty)
   - **Runtime**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`
   - **Health Check Path**: `/health`

3. **Set Environment Variables** (same as Option 1)

4. **Click "Create Web Service"**

## Setting FIREBASE_CREDENTIALS_JSON

**IMPORTANT**: This must be the **entire JSON content** of your service account key file, NOT a file path.

### Steps:

1. **Open your Firebase service account key file**:
   - File: `londa-cd054-firebase-adminsdk-fbsvc-d4c5117970.json`
   - Or: `firebase-credentials.json`

2. **Copy the entire JSON content** (everything from `{` to `}`)

3. **In Render Dashboard**:
   - Go to your service → Environment tab
   - Click "Add Environment Variable"
   - Name: `FIREBASE_CREDENTIALS_JSON`
   - Value: Paste the entire JSON content
   - **Important**: Make sure it's all on one line or properly formatted

### Example Format:

The value should look like this (all on one line):
```json
{"type":"service_account","project_id":"londa-cd054","private_key_id":"...","private_key":"-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n","client_email":"...","client_id":"...","auth_uri":"...","token_uri":"...","auth_provider_x509_cert_url":"...","client_x509_cert_url":"..."}
```

## After Deployment

1. **Get Your Service URL**:
   - Render will provide a URL like: `https://londa-apis-xxxx.onrender.com`
   - This is your API base URL

2. **Test Health Endpoint**:
   - Visit: `https://londa-apis-xxxx.onrender.com/health`
   - Should return: `{"status": "healthy"}`

3. **Test API Docs**:
   - Visit: `https://londa-apis-xxxx.onrender.com/docs`
   - Should show Swagger UI

4. **Test Root Endpoint**:
   - Visit: `https://londa-apis-xxxx.onrender.com/`
   - Should return welcome message

## Environment Variables Checklist

Use this checklist to ensure all variables are set:

### Required
- [ ] `FIREBASE_CREDENTIALS_JSON` = `[full JSON content]` ⚠️ **CRITICAL**
- [ ] `FIREBASE_PROJECT_ID` = `londa-cd054` (already in render.yaml)
- [ ] `GOOGLE_MAPS_API_KEY` = `[your-api-key]`
- [ ] `SMTP_USER` = `[your-email]`
- [ ] `SMTP_PASS` = `[your-app-password]`
- [ ] `SECRET_KEY` = `[auto-generated by Render]`

### Optional
- [ ] `SMTP_FROM` = `noreply@londarides.com`
- [ ] `EMAIL_ACTIVATION_SECRET` = `[your-secret]`
- [ ] `BACKEND_CORS_ORIGINS` = `https://yourdomain.com,https://www.yourdomain.com`
- [ ] `NYLAS_API_KEY` = `[your-nylas-key]` (if using Nylas)

## Troubleshooting

### Build Failures

1. **"Module not found"**:
   - Check that `requirements.txt` is up to date
   - Verify all dependencies are listed

2. **"Firebase initialization failed"**:
   - Verify `FIREBASE_CREDENTIALS_JSON` is set correctly
   - Check that JSON content is valid
   - Ensure `FIREBASE_PROJECT_ID` matches your Firebase project

### Runtime Errors

1. **"Port already in use"**:
   - Render automatically sets `$PORT` - don't override it
   - Ensure start command uses `--port $PORT`

2. **"CORS errors"**:
   - Update `BACKEND_CORS_ORIGINS` with your frontend URLs
   - Use comma-separated format: `https://app1.com,https://app2.com`

3. **"Firebase credentials not found"**:
   - Verify `FIREBASE_CREDENTIALS_JSON` is set
   - Check that JSON content is complete and valid
   - Ensure no extra quotes or escaping issues

## Service Plans

- **Free Tier**: $0/month - Service sleeps after 15 minutes of inactivity
- **Starter Plan**: $7/month - Always-on service
- **Standard Plan**: $25/month - Better performance and resources

**Recommendation**: Start with free tier for testing, upgrade to starter for production.

## Custom Domain Setup

To use a custom domain:

1. Go to your service in Render dashboard
2. Click "Settings" → "Custom Domains"
3. Add your domain (e.g., `api.londarides.com`)
4. Follow DNS configuration instructions

## Monitoring

Render provides:
- **Logs**: Real-time logs for your service
- **Metrics**: CPU, memory, and request metrics
- **Alerts**: Set up alerts for service failures

## Updating Your Service

To update after code changes:

1. Push changes to GitHub
2. Render will automatically detect changes (if auto-deploy is enabled)
3. Or manually trigger deployment from Render dashboard

## Security Best Practices

1. **Never commit** `.env` files or service account keys to Git
2. **Use Render Secrets** for sensitive environment variables
3. **Enable HTTPS** (automatic on Render)
4. **Set strong SECRET_KEY** (Render auto-generates this)
5. **Regularly rotate** secrets and API keys

## Support

For issues:
1. Check Render service logs
2. Review build logs for errors
3. Verify environment variables are set correctly
4. Test health endpoint: `/health`
5. Check API docs: `/docs`

---

**Next Steps**:
1. Connect repository to Render
2. Configure environment variables (especially `FIREBASE_CREDENTIALS_JSON`)
3. Deploy service
4. Test endpoints
5. Set up custom domain (optional)

For more information, see [Render Documentation](https://render.com/docs).

